<!doctype html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>PokemonGO Lingen Raid Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.1/dist/leaflet.css" integrity="sha256-sA+zWATbFveLLNqWO2gtiw3HL/lh1giY/Inf1BJ0z14=" crossorigin=""/>
    <style>
        html, body {
            margin: 0;
        }
        #map {
            width: 100vw;
            height: 100vh;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <script src="https://unpkg.com/leaflet@1.9.1/dist/leaflet.js" integrity="sha256-NDI0K41gVbWqfkkaHj15IzU7PtMoelkzyKp8TOaFQ3s=" crossorigin=""></script>
    <script>
        var map = L.map('map').setView([52.5167612,7.3183457], 15);

        var tiles = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(map);

        let gyms = window.fetch('gyms/lingen.json').then((res) => res.json()).then((json) => {
            for (gym of json) {

                let icon = null;
                let raid = '';
                if (gym.raid) {
                    let hatchTime = new Date(gym.raid.hatchTime.slice(0,-1) + '+00:00');
                    let endTime = new Date(gym.raid.endTime.slice(0,-1) + '+00:00');


                    raid = `
                        <strong>Raid: ${gym.raid.boss ?? raid.boss.level}</strong><br>
                        <span>${hatchTime.toLocaleTimeString()} bis ${endTime.toLocaleTimeString()}</span><br>
                        <img src="${gym.raid.image}" width="64" />
                    `;

                    icon = L.icon({
                        iconUrl: gym.raid.image,
                        iconSize: [32, 32],
                    });
                } else {
                    raid = `<img src="${gym.image}" width="128" />`
                }
                if (icon) {
                    marker = L.marker([gym.location.lat, gym.location.lng], {icon: icon}).addTo(map);
                } else {
                    marker = L.marker([gym.location.lat, gym.location.lng]).addTo(map);
                }

                marker.bindPopup(`
                    <h3>${gym.name}</h3>
                    ${raid}
                `);
            }
        })

    </script>
</body>
</html>